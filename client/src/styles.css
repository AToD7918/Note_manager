:root { --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e2e8f0; --accent:#22c55e; --border:#1f2937; }
* { box-sizing: border-box }
body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji"; background: var(--bg); color: var(--text); }
.app { display:flex; flex-direction:column; height:100vh; position:relative; }
.content-row { display:flex; flex:1; min-height:0; }
.topnav { display:flex; gap:8px; padding:8px 12px; border-bottom:1px solid var(--border); background:#0b1220; }
.topnav .tab { background:#1f2937; border:1px solid var(--border); color:var(--text); padding:6px 10px; border-radius:6px; cursor:pointer; }
.topnav .tab.active { background: var(--accent); border-color: var(--accent); color:#06210f; font-weight:700; }
.hidden { display:none; }
.sorts-view { flex:1; overflow:auto; }
.sorts-panel { padding:16px; }
.graph-view { flex:1; overflow:hidden; }
.graph-panel { padding:16px; height:100%; display:flex; flex-direction:column; }
.graph-row { display:flex; gap:12px; flex:1; min-height:0; }
.graph-left { flex:2.2; border:1px solid var(--border); border-radius:8px; background:#0b1220; display:flex; align-items:center; justify-content:center; }
.graph-right { flex:0.8; min-width:280px; border:1px solid var(--border); border-radius:8px; background:#0b1220; padding:12px; overflow:auto; }
.graph-canvas { width:100%; height:100%; min-height:420px; position:relative; overflow:hidden; flex:1; }
.graph-right .title { font-size:16px; font-weight:600; margin-bottom:6px; }
.graph-right .meta { font-size:12px; color:var(--muted); margin-bottom:10px; }
.graph-right .section { margin-bottom:10px; }
.subject-manager { border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:16px; background:#0b1220; }
.sm-row { display:flex; gap:8px; }
.sm-input { flex:1; padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.chip { display:flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; cursor:pointer; }
.chip-x { background:transparent; border:none; color:var(--muted); cursor:pointer; }
.group { border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:12px; background:#0b1220; }
.group-title { font-weight:600; margin-bottom:8px; }
.group-item { display:flex; justify-content:space-between; padding:8px; border:1px solid var(--border); border-radius:8px; margin-bottom:6px; cursor:pointer; }
.group-item:hover { background:#0b1220; }
.gi-title { font-size:14px; }
.gi-meta { font-size:12px; color:var(--muted); }
.sidebar { width: 300px; border-right:1px solid var(--border); display:flex; flex-direction:column; min-height:0; }
.sidebar-header { display:flex; align-items:center; justify-content:space-between; padding:12px; border-bottom:1px solid var(--border); }
.search-box { padding:8px 12px; border-bottom:1px solid var(--border); }
.search-input { width:100%; padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.sort-box { display:flex; align-items:center; gap:8px; padding:8px 12px; border-bottom:1px solid var(--border); }
.sort-box label { color: var(--muted); font-size:12px; }
.sort-select { flex:1; padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.note-list { flex:1; overflow:auto; }
.sb-subject { padding:6px 12px; color:#cbd5e1; font-size:12px; background:#0b1220; border-top:1px solid var(--border); cursor:pointer; display:flex; align-items:center; gap:6px; }
.note-item { padding:10px 12px; cursor:pointer; border-bottom:1px solid var(--border); }
.note-item:hover { background:#0b1220 }
.note-item.selected { background:#0b1220 }
.note-item .title { font-weight:600; font-size:14px; }
.note-item .meta { color: var(--muted); font-size:12px; margin-top:4px; }
.btn { background:#1f2937; border:1px solid var(--border); color:var(--text); padding:6px 10px; border-radius:6px; cursor:pointer; }
.btn:hover { background:#243042 }
.btn.primary { background: var(--accent); border-color: var(--accent); color:#06210f; font-weight:700 }
.btn.danger { background:#7f1d1d; border-color:#7f1d1d; color:#fee2e2; }
.btn.danger:hover { background:#991b1b }
.btn.error { background:#991b1b; border-color:#991b1b; color:#fee2e2; }
.shake { animation: shake 0.4s linear 1; }
@keyframes shake {
  0%,100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  50% { transform: translateX(4px); }
  75% { transform: translateX(-2px); }
}
.bubble {
  display:block; width:fit-content; margin:8px 0 0 auto; padding:6px 10px; border-radius:8px; border:1px solid var(--border); background:#0b1220; color:#e2e8f0; font-size:12px; text-align:right; max-width:100%;
}
.builder { text-align:left; }
.main { flex:1; display:flex; min-height:0; }
.editor { flex:1; display:flex; flex-direction:column; min-height:0; }
.editor-header { display:flex; gap:12px; align-items:center; padding:12px; border-bottom:1px solid var(--border); }
.title-input { flex:1; padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; font-size:16px; }
.content-top { padding:10px 12px; border-bottom:1px solid var(--border); display:flex; flex-direction:column; gap:8px; }
.search-input.wide { width:100%; }
.content-results { max-height:200px; overflow:auto; display:flex; flex-direction:column; gap:6px; }
.editor-body { display:flex; flex:1; min-height:0; overflow:hidden; }
.fields { flex:1; padding:16px; overflow:auto; }
.properties { margin-top:8px; border-top:1px solid var(--border); padding-top:12px; }
.props-row { display:flex; gap:12px; margin-bottom:8px; }
.prop { display:flex; flex-direction:column; gap:6px; }
.prop.wide { flex:1; }
.prop select, .prop input { padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.subject-row { display:flex; gap:8px; }
.subject-row select { flex:1; padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.custom-props { margin-top:10px; }
.custom-props .props-header { font-size:13px; color:#cbd5e1; margin-bottom:6px; }
.prop.kv { display:flex; flex-direction:row; align-items:center; gap:8px; margin-bottom:6px; }
.kv-key, .kv-val { flex:1; padding:8px 10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.field { margin-bottom:12px; }
.field label { display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
.field textarea, .field input { width:100%; padding:10px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:8px; }
.field textarea { resize: none; }
.resize-vertical { resize: vertical !important; }
.field.small-title label { font-size:16px; color:#e2e8f0; font-weight:600; margin-top:8px; }
.field.compact textarea { min-height:0; }
.suggestions { width:360px; border-left:1px solid var(--border); padding:12px; overflow:auto; }
.sugg-section { margin-bottom:16px; }
.sugg-section h4 { margin:6px 0 8px; font-size:14px; color:#cbd5e1; }
.sugg-item { padding:8px; border:1px solid var(--border); border-radius:8px; margin-bottom:6px; cursor:pointer; display:flex; justify-content:space-between; gap:8px; }
.sugg-item:hover { background:#0b1220 }
.sugg-item .title { font-size:13px; }
.sugg-item .score { font-size:12px; color:var(--muted); }
.muted { color: var(--muted); font-size:12px; }

/* Rich Editor */
.rich-editor { border:1px solid var(--border); border-radius:8px; background:#0b1220; }
.rich-toolbar { display:flex; flex-wrap:wrap; gap:6px; padding:8px; border-bottom:1px solid var(--border); position:sticky; top:0; background:#0b1220; z-index:1; }
.rich-editor .btn { padding:4px 8px; }
.rich-editor .btn.toggled { background: #334155; border-color:#334155; }
.rich-editor-content { min-height: 420px; padding: 12px; outline: none; }
.rich-editor-content pre { background:#0a0f1a; padding:10px; border-radius:6px; overflow:auto; }
.rich-editor-content code { background:#0a0f1a; padding:2px 4px; border-radius:4px; }
.rich-editor-content blockquote { border-left:3px solid #334155; background:#0b1220; margin:8px 0; padding:8px 12px; border-radius:6px; }
.rich-editor-content blockquote p { margin:0; }
.rich-editor-content ul { padding-left: 1.2em; }
.rich-editor-content ul[data-type="taskList"] { list-style: none; padding-left: 0; margin: 8px 0; }
.rich-editor-content ul[data-type="taskList"] li { display:flex; align-items:center; gap:8px; margin:6px 0; }
.rich-editor-content ul[data-type="taskList"] li > label { margin:0; line-height:1; display:flex; align-items:center; }
.rich-editor-content ul[data-type="taskList"] li input[type="checkbox"] { margin:0; vertical-align:middle; }
.rich-editor-content ul[data-type="taskList"] li div { flex:1; display:flex; align-items:center; }
.rich-editor-content ul[data-type="taskList"] li div > p { margin:0; line-height:1.4; }
.rich-editor-content mark { background: #f59e0b33; color: inherit; padding: 0 2px; border-radius: 2px; }
.rich-editor-content table { width:100%; border-collapse: collapse; }
.rich-editor-content table th, .rich-editor-content table td { border:1px solid var(--border); padding:6px; }

/* Rich editor boxed container so rest of UI stays visible even on failure */
.rich-box { border:1px solid var(--border); border-radius:8px; background:#0b1220; display:flex; flex-direction:column; max-height:60vh; }
.rich-box-toolbar { display:flex; gap:8px; border-bottom:1px solid var(--border); padding:8px; }
.rich-box-body { padding:0; overflow:auto; }

/* Modal for shortcuts */
.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:1000; }
.modal { background:#0b1220; border:1px solid var(--border); border-radius:10px; width:min(640px, 92vw); max-height:80vh; overflow:auto; }
.modal-header { display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-bottom:1px solid var(--border); }
.modal-title { font-weight:700; }
.modal-body { padding:12px; }
.shortcut-list { margin:0; padding-left:18px; display:grid; grid-template-columns: 1fr; gap:6px; }

/* Sidebar bottom all-fields search */
.sidebar-bottom { border-top:1px solid var(--border); padding:8px 12px; }
.sb-header { font-size:12px; color:#cbd5e1; margin-bottom:6px; }
.bottom-results { max-height:180px; overflow:auto; margin-top:6px; }
